<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.13.2"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>ME405 Term Project: ME405 MECHA31 TERM PROJECT</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
  $(function() { init_search(); });
/* @license-end */
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">ME405 Term Project
   </div>
  </td>
    <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <span id="MSearchSelect"                onmouseover="return searchBox.OnSearchSelectShow()"                onmouseout="return searchBox.OnSearchSelectHide()">&#160;</span>
          <input type="text" id="MSearchField" value="" placeholder="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.13.2 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('index.html',''); initResizable(true); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">ME405 MECHA31 TERM PROJECT </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="mainpage"></a></p>
<h1><a class="anchor" id="autotoc_md0"></a>
Hello! Welcome to our Mechatronics Term Project. Created by Evan Long and Sydney Alexander.</h1>
<p>The following content documents our completion of Cal Poly's ME405 Mechatronics Term Project. The overall goal of the project was to wire and program a small, two-wheeled robot named Romi to complete an obstacle course set by the instructor. Over the course of the last several months, we have wired up the machine, installed IR, ultrasonic, and IMU sensors, and programmed it with python firmware capable of reliably completing the obstacle course.</p>
<p>A video of our robot completing the course is included below:</p>
<p> 
<iframe width="560" height="315" src="https://www.youtube.com/embed/644qalbS5Qk?si=99lT6oUaL8Q2IfnB" title="YouTube video player" allowfullscreen></iframe>
</p>
<p>We have two goals with this page. First, we wish to provide a high-level overview of the code structure, with quick navigation to anywhere in the project. Second, here we will include some of the notable features of our software.</p>
<h2><a class="anchor" id="autotoc_md1"></a>
Links to Each 11 Classes:</h2>
<ol type="1">
<li>Main.py: <a href="https://cal-poly-me405-mecha31.github.io/class_m_e405_01_term_01_project_01v5_1_1_main.html">class</a> | <a href="https://cal-poly-me405-mecha31.github.io/m_e405_01_term_01_project_01v5_8py_source.html">source</a></li>
<li>Com Task: <a href="https://cal-poly-me405-mecha31.github.io/class_com___task_1_1_com___task.html">class</a> | <a href="https://cal-poly-me405-mecha31.github.io/com___task_8py_source.html">source</a></li>
<li>Controller: <a href="https://cal-poly-me405-mecha31.github.io/class_controller_1_1_controller.html">class</a> | <a href="https://cal-poly-me405-mecha31.github.io/controller_8py_source.html">source</a></li>
<li>PID: <a href="https://cal-poly-me405-mecha31.github.io/class_p_i_d_1_1_p_i_d.html">class</a> | <a href="https://cal-poly-me405-mecha31.github.io/p_i_d_8py_source.html">source</a></li>
<li>Motor: <a href="https://cal-poly-me405-mecha31.github.io/class_motor_1_1_motor.html">class</a> | <a href="https://cal-poly-me405-mecha31.github.io/motor_8py_source.html">source</a></li>
<li>Encoder: <a href="https://cal-poly-me405-mecha31.github.io/class_encoder_1_1_encoder.html">class</a> | <a href="https://cal-poly-me405-mecha31.github.io/encoder_8py_source.html">source</a></li>
<li>Motor Controller: <a href="https://cal-poly-me405-mecha31.github.io/class_motor___task_1_1_motor___task.html">class</a> | <a href="https://cal-poly-me405-mecha31.github.io/motor___task_8py_source.html">source</a></li>
<li>IR Driver: <a href="https://cal-poly-me405-mecha31.github.io/class_i_r___sense___task_1_1_i_r___sense___task.html">class</a> | <a href="https://cal-poly-me405-mecha31.github.io/i_r___sense___task_8py_source.html">source</a></li>
<li>IMU Driver: <a href="https://cal-poly-me405-mecha31.github.io/class_i_m_u___tracker_1_1_i_m_u___tracker.html">class</a> | <a href="https://cal-poly-me405-mecha31.github.io/i_m_u___tracker_8py_source.html">source</a></li>
<li>Ultrasonic Driver: <a href="https://cal-poly-me405-mecha31.github.io/class_ultra___sense___task_1_1_ultra___sense___task.html">class</a> | <a href="https://cal-poly-me405-mecha31.github.io/ultra___sense___task_8py_source.html">source</a></li>
<li>XY Integrator: <a href="https://cal-poly-me405-mecha31.github.io/class_x_y___tracking_1_1_x_y___tracking.html">class</a> | <a href="https://cal-poly-me405-mecha31.github.io/x_y___tracking_8py_source.html">source</a></li>
</ol>
<h2><a class="anchor" id="autotoc_md2"></a>
Class Descriptions for Context:</h2>
<ol type="1">
<li>main.py - Our main file has three goals. 1: Create instances of all share/queue objects. 2. Create instances of all task objects. 3. Create and run the scheduler</li>
<li>Com Task - Handles the interaction between the bluetooth module and the other classes. Com Task handles both incoming commands as well as outgoing data transfers</li>
<li>Controller - Defines the main state space for navigating the course. The controller class defines the logic of how Romi will respond to sensor inputs from the course. Controller class also handles navigation error processing</li>
<li>PID - A generic, abstracted PID class that is used in various places across the project. Some key features include integral saturation and derivative averaging</li>
<li>Motor - A driver for Romi's DC motors. This class simply provides wrappers around the GPIO interface, but does not define any controller behavior of the motor</li>
<li>Encoder - A driver for Romi's encoders. This class does not define the timing of the encoder updates, but rather provides a simple interface to update the encoder</li>
<li>Motor Controller - In the motor controller task, we define a position and velocity PID controller for Romi's motors, using encoder feedback</li>
<li>IR Driver - A driver for the IR sensor installed on Romi. The IR sensors are the RC models, so our IR driver defines a list of callbacks for the event when the IR sensor is triggered. The main outputs are the centroid of the line and the strength of the reflectance.</li>
<li>IMU Driver - A driver for the IMU installed on Romi. The IMU automatically defines Romi's Euler angles, so the driver simply waits for calibration success, then reads the heading.</li>
<li>Ultrasonic Diver - A driver for the ultrasonic sensors installed on Romi. The ultrasonic sensors are the HC-SR04 model, which means they behave in a very similar way to the IR sensors.</li>
<li>XY Integrator - A task to continuously integrate velocity into actual cartesian coordinates. The XY coordinates are used for error handling.</li>
</ol>
<pre>

</pre><h2><a class="anchor" id="autotoc_md3"></a>
Wiring Diagram:</h2>
<p><img src="https://cal-poly-me405-mecha31.github.io/Wiring%20Diagram.jpg" alt="" style="width: 50%; height: 50%" class="inline"/></p>
<p>Figure 1. Wiring diagram for our Romi robot. Wires are colored by device, and ports are arranged on the nucleo in the actual order they are physically arranged. Using this diagram, and the code included on this webpage, future students could recreate or build on our implementation. We found that the mechanical implementation of the robot was not critical to success: our sensors were crudely fixed with tape and plastic scraps. <br  />
</p>
<pre>

</pre><h2><a class="anchor" id="autotoc_md4"></a>
Overall Task Diagram:</h2>
<p><img src="https://cal-poly-me405-mecha31.github.io/Task%20Diagram.jpg" alt="" style="width: 50%; height: 50%" class="inline"/></p>
<p>Figure 2. Task diagram for Romi's firmware. In this diagram, the cooperative tasks that are run concurrently are represented as boxes, and the objects used to commuincate between them are shown as arrows. Also included are the frequency and priority associated with each task, as provided to the scheduler. The task diagram provides visual overview of the code structure and the flow of information through the tasks.</p>
<pre>

</pre><h2><a class="anchor" id="autotoc_md5"></a>
State Machine Diagrams:</h2>
<h3><a class="anchor" id="autotoc_md6"></a>
Top Level Control:</h3>
<p><img src="https://cal-poly-me405-mecha31.github.io/Top%20Level%20Diagram.jpg" alt="" style="width: 50%; height: 50%" class="inline"/></p>
<p>Figure 3. Finite state machine diagram for the top level of code. In this diagram, states are represented as circles, and transitions between the are shown as arrows. In this way, program logic can be displayed visually without any specifics of implementation. The state machine shown here is the state machine controlling overall program behavior, such as idle or course following mode. The actual logic for this state machine is implemented in the Com Task, but the effects are comminicated to every task through the ctrlState object.</p>
<h3><a class="anchor" id="autotoc_md7"></a>
Course Controller:</h3>
<p><img src="https://cal-poly-me405-mecha31.github.io/Controller%20Diagram.jpg" alt="" style="width: 50%; height: 50%" class="inline"/></p>
<p>Figure 4. Finite state machine diagram for the course controller. The majority of our efforts to complete the course are contained in this task. The logic is straightforward: advance around the circle or return to the waiting state. In the transitions around the circle, the conditions are simplified to reduce space. The conditions can be interpreted as follows: 'line sensor' evaluates true when the reflectance from the IR sensors rises above/below a threshold, 'IMU' evaluates true when the IMU returns a heading angle within a threshold from a target heading, 'encoder' evaluates true after the encoder increments a certain value, and 'distance sensor' evaluates true when one of the ultrasonic distance sensors senses a distance above/below a set threshold.</p>
<h3><a class="anchor" id="autotoc_md8"></a>
Sensor Driver (Abstract):</h3>
<p><img src="https://cal-poly-me405-mecha31.github.io/Sensor%20Diagram.jpg" alt="" style="width: 50%; height: 50%" class="inline"/></p>
<p>Figure 5. Finite state machine diagram for each of the three sensors: the IR sensors, the IMU, and the ultrasonic sensors. Since the logic is the same for all of the sensors, they are shown here as one abstract diagram. 'Read' in this case refers to calculating offset, reading heading, or sensing distance for the IR sensors, IMU, and ultrasnonic sensor, respectively.</p>
<pre>

</pre><h2><a class="anchor" id="autotoc_md9"></a>
Control Diagrams:</h2>
<h3><a class="anchor" id="autotoc_md10"></a>
Line Follow Controller:</h3>
<p><img src="https://cal-poly-me405-mecha31.github.io/Line%20Controller.PNG" alt="" style="width: 50%; height: 50%" class="inline"/></p>
<p>Figure 6. Control block diagram for the entire system when the code is in a line following state. The cascaded PID loops were based on the model presented in lecture. Note that the dynamics have been simplified greatly for brevity: the dynamics are more complex than a SISO function. The constants shown here are pulled from the line following state for the first line of the course. We chose to avoid integral gains on our line following controller to reduce the complicated effects of integral windup and increase reliability.</p>
<h3><a class="anchor" id="autotoc_md11"></a>
Heading Controller:</h3>
<p><img src="https://cal-poly-me405-mecha31.github.io/Heading%20Controller.PNG" alt="" style="width: 50%; height: 50%" class="inline"/></p>
<p>Figure 7. Control block diagram for the entire system when the code is in a heading tracking state. Note the similarity to the line follow control diagram. In the case of heading control, we did include integral control, because we needed to ensure a higher level of accuracy than proportional control could provide alone.</p>
<pre>

</pre><h3><a class="anchor" id="autotoc_md12"></a>
Physical Parameter Characterization</h3>
<p><img src="https://cal-poly-me405-mecha31.github.io/Velocity%20Steps.PNG" alt="" style="width: 50%; height: 50%" class="inline"/></p>
<p>Figure 8. To provide a starting place for our feedforward gains in the previous controllers, we used the microcontroller to measure the dynamics of the system, extracted the data via the serial connection, and performed a regression to determine physical motor characteristics from the collected data. The displayed plot is an example of some of the raw data we collected from the microcontroller. In this plot, we did a step response of various forward voltages applied to the motors, and recorded the resulting speed as a function of time. Using this data we were able to approximate the gain and time constant of the dynamic system modeled as first order.</p>
<pre>

</pre> </div></div><!-- PageDoc -->
<a href="doxygen_crawl.html"></a>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.13.2 </li>
  </ul>
</div>
</body>
</html>
